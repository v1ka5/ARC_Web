var boss_service_selector={init:function(){var data=JSON.parse($('#srvsel_data').val());var srvsel_country_val=$('#srvsel_country').val();var srvsel_service=$('#srvsel_service');var srvsel_dest=$('#srvsel_dest');var srvsel_no_results=$('#srvsel_no_results');var srvsel_submit=$('#srvsel_submit');var srvsel_show_all=$('#srvsel_show_all');function select_item(label,value){srvsel_dest.val(label);if(srvsel_service.val()=="domestic-mobile-topup")
srvsel_submit.attr('data-url',$type.format('{0}/services/domestic-mobile-topup',boss_culture));else if(value===srvsel_country_val)
srvsel_submit.attr('data-url',$type.format('{0}/services/domestic-mobile-topup',boss_culture));else
srvsel_submit.attr('data-url',$type.format('{0}/country/{1}/{2}',boss_culture,value,srvsel_service.val()));srvsel_submit.prop('disabled',false);}
function service_changed(){var srv=srvsel_service.val();var dest_options=[];if(srv!=""){for(var isrv=0;isrv<data.length;isrv++){if(data[isrv].code==srv){for(var ictr=0;ictr<data[isrv].countries.length;ictr++){dest_options.push({label:data[isrv].countries[ictr][1],value:data[isrv].countries[ictr][0],search:diacritics.remove(data[isrv].countries[ictr][1])});}}}}
srvsel_dest.autocomplete('option','source',dest_options);srvsel_dest.val("");srvsel_submit.attr('data-url','');srvsel_submit.prop('disabled',true);srvsel_no_results.empty();srvsel_show_all.toggleClass("hidden",(dest_options.length==0));if(dest_options.length==0){srvsel_show_all.addClass("hidden");srvsel_dest.prop('disabled',true);}else if(dest_options.length==1){srvsel_show_all.addClass("hidden");srvsel_dest.prop('disabled',true);select_item(dest_options[0].label,dest_options[0].value);}else{srvsel_show_all.removeClass("hidden");srvsel_dest.prop('disabled',false);}}
srvsel_submit.prop('disabled',true);srvsel_dest.prop('disabled',true);var was_open;srvsel_show_all.mousedown(function(){was_open=srvsel_dest.autocomplete("widget").is(":visible");}).click(function(){srvsel_dest.focus();if(was_open)return;srvsel_dest.autocomplete("search","");}).hide();srvsel_submit.click(function(event){window.location.href=srvsel_submit.attr('data-url');event.preventDefault();});var options=boss.selopt("",i18n.select_service,"");for(var i=0;i<data.length;i++)options+=boss.selopt(data[i].code,data[i].name,"");srvsel_service.selectOrDie('destroy');srvsel_service.html(options).change(service_changed);srvsel_dest.val("");srvsel_dest.autocomplete({source:[],minLength:1,select:function(event,ui){event.preventDefault();select_item(ui.item.label,ui.item.value);srvsel_submit.trigger("click");},focus:function(event,ui){event.preventDefault();srvsel_dest.val(ui.item.label);},response:function(event,ui){if(ui.content.length>0)srvsel_no_results.empty().hide();else srvsel_no_results.html(String.format(i18n.no_matches_found_for,srvsel_dest.val())).show();}}).keyup(function(event){event.preventDefault();if(srvsel_dest.val().length==0){srvsel_submit.attr("disabled",true);}
if(srvsel_dest.val().length>0&&event.keyCode==13){var options=srvsel_dest.autocomplete("option").source;jQuery.each(options,function(index,device){if(srvsel_dest.val().toLowerCase()==options[index].value.toLowerCase()){select_item(options[index].label,options[index].value);srvsel_submit.trigger("click");srvsel_dest.autocomplete('close');}});}});$.ui.autocomplete.filter=function(array,term){var matcher=new RegExp("^"+$.ui.autocomplete.escapeRegex(diacritics.remove(term)),"i");return $.grep(array,function(value){return matcher.test(value.search||value.label||value.value||value);});};srvsel_service.val('international-calling');service_changed();}}
$(boss_service_selector.init);