var boss_service_selector={init:function(){var data=JSON.parse($('#ratesel_data').val());var ratesel_dest=$('#ratesel_dest');var ratesel_no_results=$('#ratesel_no_results');var ratesel_submit=$('#ratesel_submit');var ratesel_show_all=$('#ratesel_show_all');var ratesel_country=$('#ratesel_country');ratesel_no_results.empty().hide();function select_item(label,value){ratesel_dest.val(label);ratesel_submit.attr('data-country',value);ratesel_submit.prop('disabled',false);}
function load_countries(){var srv="international-calling";var sel="";var sel_label="";var sel_value="";if(ratesel_country.length)sel=ratesel_country.val();var dest_options=[];for(var i=0;i<data.length;i++){if(data[i].code==srv){for(var j=0;j<data[i].countries.length;j++){dest_options.push({label:data[i].countries[j][1],value:data[i].countries[j][0]});if(sel==data[i].countries[j][0]){sel_label=data[i].countries[j][1];sel_value=data[i].countries[j][0];}}}}
ratesel_dest.autocomplete('option','source',dest_options);ratesel_dest.val("");ratesel_submit.attr('data-country','');ratesel_submit.prop('disabled',true);ratesel_no_results.empty().hide();ratesel_show_all.prop('disabled',(dest_options.length==0));if(sel_label!="")select_item(sel_label,sel_value);else if(dest_options.length==1)select_item(dest_options[0].label,dest_options[0].value);}
ratesel_submit.prop('disabled',true);var was_open;ratesel_show_all.mousedown(function(){was_open=ratesel_dest.autocomplete("widget").is(":visible");}).click(function(){ratesel_dest.focus();if(was_open)return;ratesel_dest.autocomplete("search","");}).prop('disabled',true).hide();ratesel_dest.autocomplete({source:[],minLength:1,select:function(event,ui){event.preventDefault();select_item(ui.item.label,ui.item.value);ratesel_submit.trigger("click");},focus:function(event,ui){event.preventDefault();ratesel_dest.val(ui.item.label);},response:function(event,ui){if(ui.content.length>0){ratesel_no_results.empty().hide();ratesel_submit.attr("disabled",false);}
else{ratesel_no_results.html(String.format(i18n.no_matches_found_for,ratesel_dest.val())).show();ratesel_submit.attr("disabled",true);}}}).keyup(function(event){event.preventDefault();if(ratesel_dest.val().length==0){ratesel_submit.attr("disabled",true);}
if(ratesel_dest.val().length>0&&event.keyCode==13){var options=ratesel_dest.autocomplete("option").source;jQuery.each(options,function(index,device){if(ratesel_dest.val().toLowerCase()==options[index].value.toLowerCase()){select_item(options[index].label,options[index].value);ratesel_submit.trigger("click");ratesel_dest.autocomplete('close');}});}});$.ui.autocomplete.filter=function(array,term){var matcher=new RegExp("^"+$.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value){return matcher.test(value.label||value.value||value);});};load_countries();}}
$(boss_service_selector.init);